---
title: 【BZOJ2482】【SPOJ1557】GSS2
date: 2017-04-29 09:47:11
mathjax: true
toc: false
tags: 
- 离线
- 线段树
---

离线处理+线段树即可。

<!-- more -->

离线，将所有询问按右端点从小到大排序，从小到大枚举答案区间的右端点$i$，维护$sum[j]$表示$[j,i]$中不同值的和，每次把$sum[lst[i]+1..i]$加上$a[i]$,不难发现询问$[l,i]$的答案是$sum[l..i]$中所有元素的历史最大值的最大值。

于是问题就变成了：维护一个数据结构，支持区间加一个数，询问区间历史最大值的最大值。

线段树维护当前最大值，历史最大值。标记当前需要加上的$x$，历史最大的$x$。注意标记有时间顺序，所以需要`pushdown` 。

[Code](https://github.com/q234rty/OJ-Codes/blob/master/BZOJ/2482.cpp)
